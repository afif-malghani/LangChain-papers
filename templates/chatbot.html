<!DOCTYPE html>
<html lang="en" >
  <head>
    <meta charset="UTF-8">
    <title>ChatPDF</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato&amp;subset=latin,latin-ext">
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/css.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
        integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
        crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js">
    </script>
    
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

</head>
<body>





<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">





<style>
    ul.nav li.dropdown:hover ul.dropdown-menu{ display: block; }
    .dropdown-menu>li>a {
    padding: 7px 20px;
    border-bottom: solid 1px #ddd;
    font-weight: bold;
}
</style>



<div class="col-xl-12 col-md-12 col-sm-12 inside_topbar">
  <img src="{{ url_for('static', filename='images/botwisely.png') }}" height="100" alt="BotWisely Logo">
</div>






  


  



<div class="flex-container-1-3">



<div class="col-xl-12 col-md-2 col-sm-2" style="padding:0px; min-height: 100%">
<div class="col-xl-12 col-md-12 col-sm-12 chatbox-left">


<script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<!-- <div class="file-upload">
  <button class="file-upload-btn" type="button" onclick="$('.file-upload-input').trigger( 'click' )">Drop a PDF</button>

  <div class="image-upload-wrap">
    <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
    <div class="drag-text">
      <h5>Drag and drop a file or <br />select add PDF</h5>
    </div>
  </div>
  <div class="file-upload-content">
    <img class="file-upload-image" src="#" alt="your image" />
    <div class="image-title-wrap">
      <button type="button" onclick="removeUpload()" class="remove-image">Remove <span class="image-title">Uploaded Image</span></button>
    </div>
  </div>
</div> -->

<div class="image-upload-wrap">
  <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
  <div class="drag-text">
    <h5>Drag and drop a file or <br />select add PDF</h5>
  </div>
</div>


<!-- the param pdf_filename has a list use this list to create n elements -->

<ul class="chat-list">


  {% for pdf in pdf_filename["pdf_list"]:%}
    <!-- if first element add class active -->
    {% if pdf == pdf_filename["active_pdf"] %}
      <li><a class="active-chat" href="#"><div class="chat-linker">
        <img src="{{ url_for('static', filename='images/icons8-chat-50.png')}}" alt="chat"/>
        <p>
          {{ pdf }}
        </p>
        
      </div> 
      </a></li>
    {% else %}
      <li><a href="#" onclick="switchChat()"><div class="chat-linker">
        <img src="{{ url_for('static', filename='images/icons8-chat-50.png')}}" alt="chat"/>
        <p>
          {{ pdf }}
        </p>
        
      </div> 
      </a></li>
    {% endif %}
<!-- <li><a href="#"><div class="chat-linker">
  <img src="{{ url_for('static', filename='images/icons8-chat-50.png')}}" alt="chat"/>
  <p>
    {{ pdf }}
  </p>
  
</div> 
</a></li> -->
  
  {% endfor %}
</ul>

</div>

</div>

<div class="col-xl-12 col-md-5 col-sm-5">
  <object data="{{ url_for('static', filename='pdf/'+pdf_filename['active_pdf']) }}" type="application/pdf" width="100%" height="700px"></object>
</div>



<div class="conversation">
  <div class="conversation-container">
    



  </div>
  
  <form class="conversation-compose" id="queryForm">
    <input class="input-msg" id="queryInput" name="input" placeholder="Type a message" autocomplete="off" autofocus>
    <div class="photo">
        <i class="zmdi zmdi-camera"></i>
    </div>
    <button class="send" type="submit">
        <div class="circle">
            <i class="zmdi glyphicon glyphicon-chevron-right"></i>
        </div>
    </button>
</form>
</div>
        </div>






</div>


<!--part1-->



  
<!--footer-->
  
                                
                                
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'>

  </script>
<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
  <script  src="js/script.js"></script>



  <script>
    function switchChat(){
      console.log("function called")
      var active_pdf = $(event.target).text().trim();
      var pdf_list = [];
      var pdf_list_elements = document.getElementsByClassName("chat-linker");
      for (var i = 0; i < pdf_list_elements.length; i++) {
        pdf_list.push(pdf_list_elements[i].innerText.trim());
      }
      var requestData = {
        pdf_list: pdf_list,
        active_pdf: active_pdf
    };
    fetch('/switch', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json'
      },
      body: JSON.stringify(requestData)
  })
  .then(response => {
      // Handle the response as needed
      if (response.ok) {
          // Do something with a successful response
      } else {
          // Handle errors
      }
  })
  .catch(error => {
      console.error('Error:', error);
  });
    }
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const queryForm = document.getElementById("queryForm");
      const queryInput = document.getElementById("queryInput");
      const active_pdf = document.getElementsByClassName("active-chat")[0].innerText.trim(); 
      queryForm.addEventListener("submit", function (e) {
          e.preventDefault(); // Prevent the default form submission
  
          const query = queryInput.value;

          // add message sent to conversation
          var conversation = document.getElementsByClassName("conversation-container")[0];
          var message_sent = document.createElement("div");
          message_sent.className = "message sent";
          // get current time in 12 hour format 
          var date = new Date();
          var hours = date.getHours() > 12 ? date.getHours() - 12 : date.getHours();
          var am_pm = date.getHours() >= 12 ? "PM" : "AM";
          var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
          var time = hours + ":" + minutes + " " + am_pm;

          message_sent.innerHTML = query + '<span class="metadata"><span class="time">'+time+'</span></span>';
          conversation.appendChild(message_sent);
          // scroll to bottom
          conversation.scrollTop = conversation.scrollHeight;


          console.log(query);
  
          if (query) {
              // Create an object with the "query" key and the input value
              var requestData = {
                  query: query,
                  active_pdf: active_pdf
              };
  
              // Send a POST request to the "/query" route
              fetch("/query", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json",
                  },
                  body: JSON.stringify(requestData),
              })
                  .then((response) => response.json())
                  .then((data) => {
                      console.log("Response:", data);
                      // add message received to conversation
                      var date = new Date();
                      var hours = date.getHours() > 12 ? date.getHours() - 12 : date.getHours();
                      var am_pm = date.getHours() >= 12 ? "PM" : "AM";
                      var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                      var time = hours + ":" + minutes + " " + am_pm;

                      var conversation = document.getElementsByClassName("conversation-container")[0];
                      var message_received = document.createElement("div");
                      message_received.className = "message received";
                      message_received.innerHTML = data + '<span class="metadata"><span class="time">'+time+'</span></span>';
                      conversation.appendChild(message_received);
                      // scroll to bottom
                      conversation.scrollTop = conversation.scrollHeight;

                      // Handle the response as needed
                      // You can update the UI with the response data here
                  })
                  .catch((error) => {
                      console.error("Error:", error);
                  });
  
              // Clear the input field
              queryInput.value = "";
          }
      });
  });
  
  </script>

</body>
</html>
